{% extends "core/base.html" %}
{% load static %}
{% block title %}Resume Builder - CareerAI{% endblock %}

{% block content %}
<script src="{% static 'js/resume.js' %}" defer></script>

<div class="container py-8">
    <div class="flex justify-between items-center mb-4 heading-y-padding">
        <h1>ATS Resume Builder</h1>

        {% if user.is_superuser %}
            <a href="{% url 'admin_dashboard' %}" class="btn btn-outline"><i class="fas fa-arrow-left"></i> Admin Dashboard</a>
        {% else %}
            <a href="{% url 'dashboard' %}" class="btn btn-outline"><i class="fas fa-arrow-left"></i> Dashboard</a>
        {% endif %}
    </div>

    <form method="POST" action="{% url 'resume_save' %}">
        {% csrf_token %}

        <!-- Personal Info -->
        <div class="card mb-8">
            <h3 class="mb-4 text-accent"><i class="fas fa-user-circle"></i> Personal Information</h3>
            <div class="grid grid-2">
                <div class="input-group">
                    <label>Full Name</label>
                    <input name="full_name" value="{{ full_name|default:'' }}" required>
                </div>
                <div class="input-group">
                    <label>Email</label>
                    <input name="email" value="{{ email|default:'' }}" required>
                </div>
                <div class="input-group">
                    <label>Phone</label>
                    <input name="phone" value="{{ phone|default:'' }}" required>
                </div>
                <div class="input-group">
                    <label>LinkedIn</label>
                    <input name="linkedin" value="{{ linkedin|default:'' }}">
                </div>
                <div class="input-group">
                    <label>GitHub</label>
                    <input name="github" value="{{ github|default:'' }}">
                </div>
                <div class="input-group">
                    <label>Portfolio</label>
                    <input name="portfolio" value="{{ portfolio|default:'' }}">
                </div>
            </div>
        </div>

        <!-- Summary -->
        <div class="card mb-8">
            <h3 class="mb-4 text-accent"><i class="fas fa-align-left"></i> Professional Summary</h3>
            <textarea name="summary" rows="4" placeholder="Brief professional summary (2-4 lines)...">{{ summary|default:'' }}</textarea>
        </div>

        <!-- Skills -->
        <div class="card mb-8">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-accent"><i class="fas fa-tools"></i> Skills</h3>
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" name="show_skill_categories" {% if show_skill_categories %}checked{% endif %} style="width: auto;">
                    <span style="font-size: 0.9rem;">Categorize in PDF</span>
                </label>
            </div>
            <input name="skills" value="{{ skills_raw|default:'' }}" placeholder="Python, Java, React, SQL, AWS (Comma separated)">
        </div>

        <!-- Education -->
        <div class="mb-8">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-accent"><i class="fas fa-graduation-cap"></i> Education <span style="font-size: 0.85rem; font-weight: 400; color: var(--text-muted); margin-left: 0.5rem; text-transform: none;">(Add only recent 2 educations)</span></h3>
                <button type="button" onclick="addEducation()" class="btn btn-sm btn-outline"><i class="fas fa-plus"></i> Add</button>
            </div>
            <div id="education-container"></div>
        </div>

        <!-- Experience -->
        <div class="mb-8">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-accent"><i class="fas fa-briefcase"></i> Experience <span style="font-size: 0.85rem; font-weight: 400; color: var(--text-muted); margin-left: 0.5rem; text-transform: none;">(Add only recent 2 experience details)</span></h3>
                <button type="button" onclick="addExperience()" class="btn btn-sm btn-outline"><i class="fas fa-plus"></i> Add</button>
            </div>
            <div id="experience-container"></div>
        </div>

        <!-- Projects -->
        <div class="mb-8">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-accent"><i class="fas fa-laptop-code"></i> Projects <span style="font-size: 0.85rem; font-weight: 400; color: var(--text-muted); margin-left: 0.5rem; text-transform: none;">(Add only recent 2 projects)</span></h3>
                <button type="button" onclick="addProject()" class="btn btn-sm btn-outline"><i class="fas fa-plus"></i> Add</button>
            </div>
            <div id="projects-container"></div>
        </div>

        <!-- Certifications -->
        <div class="mb-8">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-accent"><i class="fas fa-certificate"></i> Certifications <span style="font-size: 0.85rem; font-weight: 400; color: var(--text-muted); margin-left: 0.5rem; text-transform: none;">(Add only recent 2 certifications)</span></h3>
                <button type="button" onclick="addCertification()" class="btn btn-sm btn-outline"><i class="fas fa-plus"></i> Add</button>
            </div>
            <div id="certifications-container"></div>
        </div>

        <!-- Actions -->
        <div class="card sticky-bottom p-4 flex gap-2 justify-center" style="position: sticky; bottom: 1rem; z-index: 40; border-top: 2px solid var(--primary); background: var(--bg-card);">
            <button name="action" value="preview" class="btn btn-outline sticky-action-btn">
                <i class="fas fa-eye"></i> Preview
            </button>
            <button name="action" value="download" class="btn btn-primary sticky-action-btn">
                <i class="fas fa-download"></i> Download PDF
            </button>
        </div>

    </form>
</div>
{% endblock %}