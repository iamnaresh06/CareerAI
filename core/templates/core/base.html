{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      {% block title %}CareerAI - Smart Career Guidance{% endblock %}
    </title>

    <!-- Favicon - Multiple sizes for better quality -->
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'core/img/favicon.png' %}" />
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'core/img/favicon.png' %}" />
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'core/img/favicon.png' %}" />
    <link rel="shortcut icon" href="{% static 'core/img/favicon.png' %}" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <!-- Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <!-- Main CSS -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar glass">
      <div class="container nav-content">
        <a href="{% url 'home' %}" class="nav-logo">
          <img src="{% static 'core/img/logo.png' %}" alt="CareerAI Logo" />
        </a>

        <button class="mobile-menu-btn" onclick="toggleMenu()">
          <i class="fas fa-bars"></i>
        </button>

        <div class="nav-links" id="navLinks">
          {% if user.is_authenticated %}
          <a href="{% url 'dashboard' %}">Dashboard</a>
          <a href="{% url 'job_list' %}">Jobs & Internships</a>
          <a href="{% url 'event_list' %}">Events & Hackathons</a>
          <a href="{% url 'analyze' %}">Resume Analyzer</a>
          <a href="{% url 'job_readiness' %}">Job Readiness</a>
          <a href="{% url 'logout' %}">Logout</a>
          {% else %}
          <a href="{% url 'login' %}">Login</a>
          <a
            href="{% url 'register' %}"
            class="btn btn-primary"
            >Sign Up</a
          >
          {% endif %}
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main style="flex: 1; padding-bottom: 2rem;">
      {% if messages %}
      <div class="container mt-4">
        {% for message in messages %}
        <div
          class="card alert-card"
          style="background: {{ message.tags|yesno:'var(--success),var(--error)' }}; color: white; padding: 1rem; margin-bottom: 1rem; border: none;"
        >
          <div class="flex items-center gap-2">
            <i class="fas {% if message.tags == 'success' %}fa-check-circle{% else %}fa-exclamation-circle{% endif %}"></i>
            {{ message }}
          </div>
        </div>
        {% endfor %}
      </div>
      {% endif %} 
      {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer>
      <div class="container footer-content">
        <p class="footer-text">&copy; 2026 CareerAI | Developed by Naresh Reddy.</p>
        <div class="flex justify-center gap-4">
          <a href="https://www.linkedin.com/in/iamnaresh06" target="_blank" class="social-link"><i class="fab fa-linkedin fa-lg"></i></a>
          <a href="https://github.com/iamnaresh06" target="_blank" class="social-link"><i class="fab fa-github fa-lg"></i></a>
          <a href="mailto:iamnaresh06@gmail.com" class="social-link"><i class="fas fa-envelope fa-lg"></i></a>
        </div>
        
        <div style="margin-top: 0.5rem;">
          <a href="{% url 'admin_dashboard' %}" style="color: var(--text-muted); font-size: 0.8rem; opacity: 0.6; transition: var(--transition);" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.6'">
            <i class="fas fa-lock"></i> Admin Dashboard
          </a>
        </div>
      </div>
    </footer>

    <!-- Chatbot Widget -->
    <div id="career-bot">
      <button id="bot-toggle" onclick="toggleBot()">
        <i class="fas fa-robot"></i>
      </button>

      <div id="bot-box" class="card glass">
        <div
          class="flex justify-between items-center mb-4"
          style="
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 0.5rem;
          "
        >
          <span style="font-weight: 700; color: var(--accent)"
            >AI Career Assistant</span
          >
          <div>
            <button
              onclick="clearChat()"
              class="btn-outline"
              style="padding: 0.2rem 0.5rem; font-size: 0.8rem"
            >
              <i class="fas fa-trash"></i>
            </button>
            <button
              onclick="toggleBot()"
              class="btn-outline"
              style="padding: 0.2rem 0.5rem; font-size: 0.8rem"
            >
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>

        <div id="bot-messages"></div>

        <div class="input-group" style="margin-bottom: 0; margin-top: 1rem">
          <input
            type="text"
            id="bot-input"
            placeholder="Ask career questions..."
            onkeydown="if(event.key==='Enter') sendBotMessage()"
          />
          <button
            onclick="sendBotMessage()"
            class="btn btn-primary"
            style="margin-top: 0.5rem; width: 100%"
          >
            Send
          </button>
        </div>
      </div>
    </div>

    <!-- Styles for Bot (Inline for specific widget logic) -->
    <style>
      #career-bot {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        z-index: 1000;
      }
      #bot-toggle {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: var(--primary);
        color: white;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        box-shadow: var(--shadow-glow);
        transition: var(--transition-bounce);
      }
      #bot-toggle:hover {
        transform: scale(1.1) rotate(10deg);
      }
      #bot-box {
        display: none;
        position: absolute;
        bottom: 80px;
        right: 0;
        width: 350px;
        height: min(500px, calc(100vh - 140px));
        display: flex;
        flex-direction: column;
        transform-origin: bottom right;
        transition: var(--transition-bounce);
        opacity: 0;
        pointer-events: none;
        transform: scale(0.9) translateY(20px);
        overflow: hidden;
        border: 1px solid rgba(0,0,0,0.1);
        box-shadow: var(--shadow-xl);
      }
      #bot-box.open {
        display: flex;
        opacity: 1;
        pointer-events: all;
        transform: scale(1) translateY(0);
      }
      #bot-messages {
        flex: 1;
        overflow-y: auto;
        padding-right: 0.5rem;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }
      #bot-messages div {
        background: #f1f5f9; /* Light grey for bot messages */
        padding: 0.75rem 1rem;
        border-radius: var(--radius-md);
        font-size: 0.9rem;
        color: var(--text-main);
        border: 1px solid rgba(0,0,0,0.03);
      }

      /* Mobile Adjustment */
      @media (max-width: 768px) {
        #career-bot {
          bottom: 1.5rem;
          right: 1.5rem;
        }
        #bot-box {
          width: calc(100vw - 3rem);
          height: calc(100vh - 160px);
          bottom: 75px;
          right: 0;
        }
        .nav-logo {
          font-size: 1.25rem;
        }
        .alert-card {
           font-size: 0.9rem;
           border-radius: var(--radius-md);
        }
      }
    </style>

    <script>
      function toggleMenu() {
        document.getElementById("navLinks").classList.toggle("active");
      }

      function toggleBot() {
        document.getElementById("bot-box").classList.toggle("open");
      }

      function sendBotMessage() {
        const input = document.getElementById("bot-input");
        const msg = input.value.trim();
        if (!msg) return;

        const box = document.getElementById("bot-messages");

        box.innerHTML += `<div style="background: rgba(99, 102, 241, 0.2); align-self: flex-end;"><strong>You:</strong> ${msg}</div>`;
        input.value = "";
        box.scrollTop = box.scrollHeight;

        fetch("{% url 'career_chatbot' %}", {
          method: "POST",
          headers: {
            "X-CSRFToken": "{{ csrf_token }}",
            "Content-Type": "application/x-www-form-urlencoded",
          },
          body: new URLSearchParams({ message: msg }),
        })
          .then((res) => res.json())
          .then((data) => {
            const reply = data.reply;
            const botMsg = document.createElement("div");
            botMsg.innerHTML = "<strong>AI:</strong><br>";
            botMsg.style.whiteSpace = "pre-line";
            box.appendChild(botMsg);

            let i = 0;
            const typing = setInterval(() => {
              if (i < reply.length) {
                botMsg.innerHTML += reply.charAt(i);
                i++;
                box.scrollTop = box.scrollHeight;
              } else {
                clearInterval(typing);
              }
            }, 10);
          })
          .catch((err) => {
            box.innerHTML += `<div style="color: var(--error);">Error contacting AI.</div>`;
          });
      }

      function clearChat() {
        const box = document.getElementById("bot-messages");
        box.innerHTML = "<div><strong>AI:</strong><br>History cleared.</div>";
      }
    </script>
  </body>
</html>
